{"version":"NotebookV1","origId":2382794847744706,"name":"04b_challenger_approval","language":"python","commands":[{"version":"CommandV1","origId":4636292281853082,"guid":"6174bb35-b7e9-46d7-a9d7-8688151fdff6","subtype":"command","commandType":"auto","position":1.0,"command":"%pip install --quiet mlflow-skinny --upgrade --pre\n\n%restart_python","commandVersion":7,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"\u001B[43mNote: you may need to restart the kernel using %restart_python or dbutils.library.restartPython() to use updated packages.\u001B[0m\n","name":"stdout","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1761233830467,"submitTime":1761233830414,"finishTime":1761233858863,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"latestAssumeRoleInfo":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",132]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"2e45435a-077d-42d9-be21-2e8804b6925e"},{"version":"CommandV1","origId":4636292281853084,"guid":"37eef795-73e7-4ff0-b738-9404cb4ff691","subtype":"command","commandType":"auto","position":2.0,"command":"import mlflow\nfrom mlflow.tracking.client import MlflowClient\n\nclient = MlflowClient(registry_uri=\"databricks-uc\")\nclient","commandVersion":18,"state":"finished","results":{"type":"listResults","data":[{"type":"mimeBundle","data":{"text/plain":"<mlflow.tracking.client.MlflowClient at 0xffd0bf278200>"},"executionCount":4,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"kernelSessionId":"41bad5f4-6919e7ff5933def4dd89d4e8"}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1761234015563,"submitTime":1761234015523,"finishTime":1761234016599,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"latestAssumeRoleInfo":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["mimeBundle",null]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"c060ce7a-bd2e-4c04-a7ac-4a6371a8146c"},{"version":"CommandV1","origId":4636292281853086,"guid":"e7dd4f7a-a8ad-4c1c-92b1-ba08495c7a9f","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n## Validating the new version/Challenger to Champion","commandVersion":2,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"latestAssumeRoleInfo":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"c8388aa8-05d7-49ab-85dc-ca3ddbbfe232"},{"version":"CommandV1","origId":4636292281853085,"guid":"dd4cfe9e-8e45-4ae6-bf81-8372e8cde50b","subtype":"command","commandType":"auto","position":1.5,"command":"catalog='sai_datastorage'\ndb='default'\ndbutils.widgets.text(\"model_name\", f\"{catalog}.{db}.advanced_mlops_churn\", \"Model Name\")\ndbutils.widgets.text(\"model_version\", \"1\", \"Model Version\")\ndbutils.widgets.text(\"approval_tag_name\", \"Approval_Check\", \"Approval tag to check\")","commandVersion":29,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{"model_version":{"widgetType":"text","name":"model_version","defaultValue":"1","label":"Model Version","options":{"widgetType":"text","validationRegex":null,"autoCreated":null}},"model_name":{"widgetType":"text","name":"model_name","defaultValue":"sai_datastorage.default.advanced_mlops_churn","label":"Model Name","options":{"widgetType":"text","validationRegex":null,"autoCreated":null}},"approval_tag_name":{"widgetType":"text","name":"approval_tag_name","defaultValue":"Approval_Check","label":"Approval tag to check","options":{"widgetType":"text","validationRegex":null,"autoCreated":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1761234004326,"submitTime":1761234004274,"finishTime":1761234004483,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"latestAssumeRoleInfo":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"149560e9-ec80-46de-aaa8-1e822f95e4e6"},{"version":"CommandV1","origId":4636292281853087,"guid":"bf5be48a-1e4d-4b06-b500-9151afe95fba","subtype":"command","commandType":"auto","position":4.0,"command":"model_name = dbutils.widgets.get(\"model_name\")\nmodel_version = dbutils.widgets.get(\"model_version\")\ntag_name = dbutils.widgets.get(\"approval_tag_name\")\ntags = client.get_model_version(model_name, model_version).tags\nprint(tags)\n\n#  check if any tag matches the approval tag name\nif not any(tag==tag_name for tag in tags.keys()):\n    raise Exception(\"Model version not approved for deployment\")\nelse:\n    if tags.get(tag_name).lower() == \"approved\":\n        print(\"Model version is approved for deployment\")\n\n        client.set_registered_model_alias(name=model_name, alias='Champion', version=model_version)\n\n    else:\n        raise Exception(\"Model version not approved for deployment\")","commandVersion":57,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"{'Approval_Check': 'Approved', 'business_metric_passed': 'True', 'has_artifacts': 'True', 'has_description': 'True', 'metric_f1_passed': 'True', 'predicts': 'True'}\nModel version is approved for deployment\n","name":"stdout","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{"model_version":"1","model_name":"sai_datastorage.default.advanced_mlops_churn","approval_tag_name":"Approval_Check"},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1761234399140,"submitTime":1761234399096,"finishTime":1761234401320,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"latestAssumeRoleInfo":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",206]],"subcommandOptions":null,"contentSha256Hex":null,"tableResultSettingsMap":{},"nuid":"7b35f3ff-0df8-459d-a80d-49b34d61d06b"}],"dashboards":[],"guid":"3bd97bab-2500-4bf9-bbbd-d0ef0c157d52","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"model_version":{"nuid":"04018b17-355c-499a-a223-1782a2c9ce10","currentValue":"1","widgetInfo":{"widgetType":"text","name":"model_version","defaultValue":"1","label":"Model Version","options":{"widgetType":"text","validationRegex":null,"autoCreated":false}},"typedWidgetInfo":{"name":"model_version","parameterDataType":"String","label":"Model Version","defaultValue":"1","options":{"widgetDisplayType":"Text","validationRegex":null},"autoCreated":false}},"model_name":{"nuid":"86ad25ff-793e-438d-9bd7-b81b32a71bc4","currentValue":"sai_datastorage.default.advanced_mlops_churn","widgetInfo":{"widgetType":"text","name":"model_name","defaultValue":"sai_datastorage.default.advanced_mlops_churn","label":"Model Name","options":{"widgetType":"text","validationRegex":null,"autoCreated":false}},"typedWidgetInfo":{"name":"model_name","parameterDataType":"String","label":"Model Name","defaultValue":"sai_datastorage.default.advanced_mlops_churn","options":{"widgetDisplayType":"Text","validationRegex":null},"autoCreated":false}},"approval_tag_name":{"nuid":"e943c5af-8a9c-4d5d-9572-d93f3abbe3da","currentValue":"Approval_Check","widgetInfo":{"widgetType":"text","name":"approval_tag_name","defaultValue":"Approval_Check","label":"Approval tag to check","options":{"widgetType":"text","validationRegex":null,"autoCreated":false}},"typedWidgetInfo":{"name":"approval_tag_name","parameterDataType":"String","label":"Approval tag to check","defaultValue":"Approval_Check","options":{"widgetDisplayType":"Text","validationRegex":null},"autoCreated":false}}},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"JUPYTER","environmentMetadata":{"client":"4","base_environment":""},"computePreferences":{"hardware":{"accelerator":null,"gpuPoolId":null,"memory":null}},"inputWidgetPreferences":null}